<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Book Exchange Map</title>
    <link rel= "stylesheet" href= "style.css">
    <!-- Bootstrap CSS -->
    <link rel= "stylesheet"
          href= "https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css"
          integrity= "sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh"
          crossorigin= "anonymous">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
    <style>
        .container {
            display: flex;
            flex-direction: row;
            justify-content: space-between;
        }
        .map-container {
            flex: 3;    /* 3/4 of the width */
            padding-right: 10px;
        }
        .weather-container {
            flex: 1;    /* 1/4 of the width */
            border-left: 1px solid #ccc;
            padding-left: 10px;
        }
    </style>
</head>
<body>
    
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
        <a class="navbar-brand" href="#">LOGO</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
    
        <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav mr-auto">
                <li class="nav-item active">
                    <a class="nav-link" href="index.html">Home</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="map.html">Map<span class="sr-only">(current)</span></a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="books.html">Book Boxes</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="about.html">About Us</a>
                </li>
            </ul>
        </div>
    </nav>


    <div class="container">
    <!-- Map Section -->

    <section class="map-container" id="map" style="height: 500px;"></section>

    <!-- Weather Section -->
    <section class="weather-container" id="weather-info">
        <h3>Weather Information</h3>
        <div id="weather-details">
            <!-- Weather data will be inserted here -->
        </div>
        
    </section>
    </div>

    <script>
        var map = L.map('map').setView([50.8798438, 4.7005176], 12);
        L.tileLayer('https://api.maptiler.com/maps/streets/{z}/{x}/{y}.png?key=Elai0T56rsYOsxHkJPwp', { attribution: '<a href="https://www.maptiler.com/copyright/" target="_blank">&copy; MapTiler</a> <a href="https://www.openstreetmap.org/copyright" target="_blank">&copy; OpenStreetMap contributors</a>' })
            .addTo(map);



        fetch('coordinates.json')
            .then(response => {
                if (!response.ok) {
                    throw new Error('Failed to fetch book exchange box data');
                }
                return response.json();
            })
            .then(data => {
                data.forEach(box => {
                    var popupContent = `<b>${box.name}</b><br>`;
                    var imageUrl = `img/${box.name}.jpg`; // Assuming images are stored in /img folder with same name as box
                    popupContent += `<img src="${imageUrl}" alt="${box.name} Image" style="max-width: 200px;">`;

                    popupContent += `<button onclick="window.location.href='/subpage/${box.name}.html';" class="btn btn-primary btn-sm" style="font-size: 0.8em; padding: 5px 10px;">Visit</button>`;
                    L.marker([box.latitude, box.longitude]).addTo(map)
                        .bindPopup(popupContent, { maxWidth: "auto" });
                });
            })
            .catch(error => {
                console.error('Error fetching book exchange box data:', error);
            });

        // Fetch weather data
        fetch('http://api.weatherapi.com/v1/current.json?key=e613b3da80d245beb45143654242704&q=50.8798438,4.7005176&aqi=yes')
            .then(response => response.json())
            .then(weatherData => {
                var weatherDetails = `
                    <p>Temperature: ${weatherData.current.temp_c} °C</p>
                    <p>Feels Like: ${weatherData.current.feelslike_c} °C</p>
                    <p>Condition: ${weatherData.current.condition.text}</p>
                    <img src="${weatherData.current.condition.icon}" alt="Weather Condition">
                    <p>Wind: ${weatherData.current.wind_kph} km/h (${weatherData.current.wind_dir})</p>
                    <p>Humidity: ${weatherData.current.humidity}%</p>
                    <p>Visibility: ${weatherData.current.vis_km} km</p>
                    <p>UV Index: ${weatherData.current.uv}</p>
                    <p>Air Quality (US-EPA Index): ${weatherData.current.air_quality["us-epa-index"]}</p>
                
                `;
                document.getElementById('weather-info').innerHTML = weatherDetails;
            })
            .catch(error => {
                console.error('Error fetching weather data:', error);
                document.getElementById('weather-info').innerText = 'Failed to fetch weather data';
            });

    </script>

<footer class="container-fluid text-center">
    <p>&copy; 2024 Book Exchange</p>
</footer>
</body>
</html>
